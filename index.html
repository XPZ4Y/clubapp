<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HyperLocal ‚Äî Clean & Professional</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <meta name="theme-color" content="#0f0518" id="meta-theme" />
  <style>
  /* ----------------------
     Theme ‚Äî Clean Pro
     Subtle glass, softened shadows, consistent spacing
     ---------------------- */
  :root{
    --bg:#0f1020;            /* page base */
    --panel:#0f1724;         /* card background */
    --glass: rgba(255,255,255,0.04);
    --muted:rgba(255,255,255,0.64);
    --accent:#7C3AED;        /* primary violet */
    --accent-2:#6EE7B7;      /* mint accent */
    --card:#0b1220;
    --soft-shadow: 0 6px 26px rgba(2,6,23,0.6);
    --radius:14px;
    --gap:14px;
    --max-w:1100px;
    --text:#E6E9F2;
    --muted-2:#A6ADBF;
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial;background:linear-gradient(180deg,#06070a 0%, #0f1020 100%);color:var(--text);-webkit-font-smoothing:antialiased}
  .app{max-width:var(--max-w);margin:28px auto;padding:20px}

  /* Header */
  .header{display:flex;align-items:center;gap:16px;padding:12px 6px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent), #5B21B6);display:flex;align-items:center;justify-content:center;color:white;font-weight:800;box-shadow:0 8px 30px rgba(124,58,237,0.12)}
  .title{font-weight:700;font-size:18px;letter-spacing:-0.3px}

  .searchWrap{flex:1;display:flex;align-items:center;gap:12px}
  .search{flex:1;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:10px;border-radius:12px;display:flex;align-items:center;border:1px solid rgba(255,255,255,0.04)}
  .search input{border:0;outline:0;background:transparent;width:100%;font-size:15px;color:var(--text)}

  .profileBtn{display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border-radius:12px;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
  .profileBtn .avatar{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--accent-2),#34D399);display:inline-flex;align-items:center;justify-content:center;font-weight:700;color:#042017}

  /* Quick filters */
  .filters{display:flex;gap:10px;overflow:auto;padding:12px 0;margin:12px 0}
  .filter{flex:0 0 auto;background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 14px;border-radius:999px;color:var(--muted-2);font-size:13px;transition:all .18s ease}
  .filter.active{background:linear-gradient(90deg, rgba(124,58,237,0.12), rgba(110,231,183,0.06));border:1px solid rgba(124,58,237,0.22);color:var(--text);box-shadow:0 6px 20px rgba(124,58,237,0.06);font-weight:600}

  /* Layout */
  .layout{display:grid;grid-template-columns:1fr 360px;gap:18px}
  @media(max-width:980px){ .layout{grid-template-columns:1fr} }

  /* Feed */
  .feed{display:flex;flex-direction:column;gap:14px;padding-bottom:120px}
  .card{display:flex;gap:14px;align-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:16px;border-radius:var(--radius);border:1px solid rgba(255,255,255,0.03);box-shadow:var(--soft-shadow);transition:transform .18s ease}
  .card:hover{transform:translateY(-6px)}

  .avatar{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#4C1D95);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:20px}
  .info{flex:1}
  .name{font-weight:700;font-size:16px;margin:0}
  .desc{font-size:13px;color:var(--muted-2);margin-top:6px;line-height:1.4}
  .meta{font-size:12px;color:var(--accent-2);margin-top:8px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px}

  .action-row{display:flex;gap:8px;align-items:center}
  .btn{padding:10px 16px;border-radius:12px;border:0;font-weight:700;cursor:pointer;font-size:14px}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#5B21B6);color:white;box-shadow:0 10px 30px rgba(124,58,237,0.14)}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted-2)}

  /* Right column */
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:14px;border-radius:16px;border:1px solid rgba(255,255,255,0.03);box-shadow:var(--soft-shadow)}
  .panel h4{margin:0 0 8px 0}
  .map-small{width:100%;height:220px;border-radius:12px;overflow:hidden;background:linear-gradient(180deg,#0b1220,#09101a)}
  .host-row{display:flex;gap:12px;align-items:center;margin-top:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(124,58,237,0.04), transparent)}

  /* Form styles (improved) */
  .form-grid{display:grid;grid-template-columns:1fr 250px;gap:14px}
  .form-row{display:flex;flex-direction:column;gap:6px}
  .label{font-size:13px;color:var(--muted-2);font-weight:600}
  .input, textarea, select{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);outline:none;font-size:14px}
  textarea{min-height:100px;resize:vertical}
  .field-help{font-size:12px;color:var(--muted-2);margin-top:6px}
  .host-preview{background:linear-gradient(90deg, rgba(124,58,237,0.04), transparent);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:center}
  .host-preview .avatar{width:48px;height:48px;border-radius:10px;font-size:16px}
  .form-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.01);font-size:13px;color:var(--muted-2)}

  /* Bottom bar */
  .bottom{position:fixed;left:18px;right:18px;bottom:18px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));backdrop-filter:blur(8px);border-radius:18px;display:flex;justify-content:space-between;align-items:center;border:1px solid rgba(255,255,255,0.03);box-shadow:0 18px 50px rgba(2,6,23,0.6);z-index:60}
  .icon{width:52px;height:52px;border-radius:12px;background:transparent;color:var(--muted-2);display:flex;align-items:center;justify-content:center;border:0}
  .fab{width:64px;height:64px;border-radius:16px;background:linear-gradient(90deg,var(--accent),#5B21B6);display:flex;align-items:center;justify-content:center;color:white;font-size:28px;border:0;box-shadow:0 10px 30px rgba(124,58,237,0.16)}

  /* Chat & modal */
  .modal{position:fixed;left:0;right:0;bottom:0;background:var(--card);border-radius:20px 20px 0 0;padding:20px;transform:translateY(110%);transition:transform .3s cubic-bezier(.2,.9,.3,1);max-height:90vh;overflow:auto;z-index:80;border-top:1px solid rgba(255,255,255,0.02)}
  .modal.show{transform:translateY(0)}

  .chat-modal{position:fixed;left:0;right:0;bottom:0;background:var(--card);border-radius:20px 20px 0 0;padding:0;transform:translateY(110%);transition:transform .28s;height:86vh;display:flex;flex-direction:column;z-index:90}
  .chat-modal.show{transform:translateY(0)}
  .chat-header{display:flex;align-items:center;padding:16px;border-bottom:1px solid rgba(255,255,255,0.02);justify-content:space-between}
  .chat-body{padding:16px;overflow:auto;flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
  .msg{display:inline-block;padding:10px 14px;border-radius:14px;margin:6px 0;max-width:74%;font-size:14px}
  .msg.me{background:linear-gradient(90deg,var(--accent),#5B21B6);color:white;margin-left:auto}
  .msg.them{background:rgba(255,255,255,0.03);color:var(--text)}

  .chat-input{display:flex;padding:12px;border-top:1px solid rgba(255,255,255,0.02);background:var(--card)}
  .chat-input input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);margin-right:10px;background:transparent;color:var(--text)}
  
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:110px;background:linear-gradient(90deg,var(--accent-2),#34D399);color:#042017;font-weight:700;padding:10px 18px;border-radius:999px;z-index:95;opacity:0;transition:opacity .28s}
  .toast.show{opacity:1}

  /* small tweaks */
  @media(max-width:420px){ .avatar{width:52px;height:52px} .fab{width:56px;height:56px;font-size:22px} .icon{width:44px;height:44px} .layout{grid-template-columns:1fr} .form-grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="brand">
        <div class="logo" aria-hidden>HL</div>
        <div>
          <div class="title">HyperLocal</div>
          <div style="font-size:12px;color:var(--muted-2);margin-top:4px">Discover curated events nearby</div>
        </div>
      </div>

      <div class="searchWrap">
        <div class="search" role="search" aria-label="Search events">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="margin-right:10px;opacity:0.7"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.3"></circle><path d="M21 21l-4.5-4.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"></path></svg>
          <input id="search" placeholder="Search events, tags or hosts" aria-label="Search"/>
        </div>
        <button id="me" class="profileBtn" aria-label="Profile"><div class="avatar">H</div><div style="font-size:13px;color:var(--muted-2);">Sign in</div></button>
      </div>
    </header>

    <div class="filters" role="tablist" aria-label="Quick filters">
      <button class="filter active" data-filter="nearby">Nearby</button>
      <button class="filter" data-filter="today">Today</button>
      <button class="filter" data-filter="music">Music</button>
      <button class="filter" data-filter="sports">Sports</button>
      <button class="filter" data-filter="tech">Tech</button>
      <button class="filter" data-filter="food">Food</button>
    </div>

    <div class="layout">
      <main class="feed" id="feed" aria-live="polite"></main>

      <aside class="panel" aria-label="Right column">
        <h4 style="margin-top:0">Featured</h4>
        <div class="map-small" id="miniMap" aria-hidden></div>
        <div style="height:12px"></div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:800">Horizon Synth</div>
            <div style="font-size:13px;color:var(--muted-2)">Live synthwave jam ‚Äî Nov 20</div>
          </div>
          <button class="btn primary" style="padding:10px 12px">Buy</button>
        </div>

        <div style="height:12px"></div>
        <div style="font-weight:800;margin-bottom:8px">Nearby Hosts</div>
        <div class="host-row">
          <div style="width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#4C1D95);display:flex;align-items:center;justify-content:center;font-weight:800;color:white">M</div>
          <div>
            <div style="font-weight:800">Maya</div>
            <div style="font-size:13px;color:var(--muted-2)">Producer ¬∑ 1.2 km</div>
          </div>
        </div>

      </aside>
    </div>

    <nav class="bottom" aria-label="Main">
      <div style="display:flex;gap:8px;align-items:center">
        <button id="home" class="icon" aria-label="Home">üè†</button>
        <button id="searchBtn" class="icon" aria-label="Search">üîé</button>
      </div>
      <button id="create" class="fab" aria-label="Create">Ôºã</button>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="chatBtn" class="icon" aria-label="Chat">üí¨</button>
        <button id="profileBottom" class="icon" aria-label="Profile">üë§</button>
      </div>
    </nav>
  </div>

  <!-- lightweight modal & chat -->
  <div id="authModal" class="modal" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div style="font-weight:800">Sign in</div>
      <button id="closeAuth" style="background:transparent;border:0;color:var(--muted-2);font-size:18px">‚úï</button>
    </div>
    <div>
      <input id="loginEmail" class="input" placeholder="Email" type="email" style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text);margin-bottom:10px"/>
      <div style="display:flex;gap:8px"><button id="doLogin" class="btn primary" style="flex:1">Sign in</button><button id="toRegister" class="btn ghost" style="flex:1">Create</button></div>
    </div>
  </div>

  <div id="sheet" class="modal" aria-hidden="true"></div>

  <div id="chat" class="chat-modal" aria-hidden="true">
    <div class="chat-header"><div style="font-weight:800">Groups</div><button id="closeChat" class="icon" style="border-radius:10px">‚úï</button></div>
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-input"><input id="chatInput" placeholder="Message..."/><button id="sendMsg" class="btn primary">Send</button></div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
  // Enhanced script: join/unjoin, create events, view joined/created/clubs (stored in localStorage)
  const SAMPLE = [
    {id:'e1',title:'Night Run',desc:'5k through the neon city ‚Äî bring lights & buddies',time:'2025-11-20T20:00:00Z',dist:400,cat:'Fitness',host:{name:'Sam',bio:'Night Runner',contact:'@sam_run',email:'sam@example.com'},lat:12.935,lng:77.624},
    {id:'e2',title:'Synthwave Jam',desc:'Bring synths & guitars ‚Äî limited slots',time:'2025-11-20T21:00:00Z',dist:1200,cat:'Music',host:{name:'Maya',bio:'Producer',contact:'@maya_music',email:'maya@example.com'},lat:12.9343,lng:77.6292},
    {id:'e3',title:'Code & Chill',desc:'Late night coding session with pizza',time:'2025-11-21T19:00:00Z',dist:2200,cat:'Tech',host:{name:'Rohit',bio:'Fullstack',contact:'@rohit_codes',email:'rohit@example.com'},lat:12.94,lng:77.62},
    {id:'e4',title:'Futsal Match',desc:'Under the lights ‚Äî bring cleats',time:'2025-11-19T18:30:00Z',dist:600,cat:'Sports',host:{name:'Asha',bio:'Coach',contact:'@asha_play',email:'asha@example.com'},lat:12.9312,lng:77.63}
  ];

  const feed = document.getElementById('feed');
  const toast = document.getElementById('toast');
  let currentUser = JSON.parse(localStorage.getItem('hl_user') || 'null');
  let detailMap = null;

  // events are persisted so created events survive reloads
  function loadEvents(){ return JSON.parse(localStorage.getItem('events') || JSON.stringify(SAMPLE)); }
  function saveEvents(events){ localStorage.setItem('events', JSON.stringify(events)); }

  function q(sel){return document.querySelector(sel)}
  function timeStr(iso){const d=new Date(iso);return d.toLocaleString(undefined,{hour:'numeric',minute:'2-digit',day:'numeric',month:'short'})}
  function distStr(m){return m<1000?m+' m':(m/1000).toFixed(1)+' km'}

  function showToast(msg, t=1400){toast.textContent = msg; toast.classList.add('show'); clearTimeout(window._t); window._t = setTimeout(()=> toast.classList.remove('show'), t)}

  function joinedKey(){ if(!currentUser) return null; return 'joined_'+currentUser.email; }
  function getJoinedSet(){ const k = joinedKey(); if(!k) return new Set(); return new Set(JSON.parse(localStorage.getItem(k)||'[]')); }
  function saveJoinedSet(set){ const k = joinedKey(); if(!k) return; localStorage.setItem(k, JSON.stringify(Array.from(set))); }

  function toggleJoinEvent(evId){ if(!currentUser){ openAuth(); showToast('Sign in to join'); return; } const set = getJoinedSet(); if(set.has(evId)){ set.delete(evId); showToast('Unjoined'); } else { set.add(evId); showToast('Joined'); } saveJoinedSet(set); render(loadEvents()); }

  function render(list){ feed.innerHTML=''; const frag = document.createDocumentFragment(); const joined = getJoinedSet();
    for(const ev of list){
      const card = document.createElement('div'); card.className='card';
      const av = document.createElement('div'); av.className='avatar'; av.textContent = ev.host.name[0];
      const info = document.createElement('div'); info.className='info';
      const name = document.createElement('div'); name.className='name'; name.textContent = ev.title;
      const desc = document.createElement('div'); desc.className='desc'; desc.textContent = ev.desc;
      const meta = document.createElement('div'); meta.className='meta'; meta.textContent = `${timeStr(ev.time)} ‚Ä¢ ${distStr(ev.dist)}`;
      info.appendChild(name); info.appendChild(desc); info.appendChild(meta);

      const actions = document.createElement('div'); actions.className='action-row';
      const isJoined = joined.has(ev.id);
      const btn = document.createElement('button'); btn.className= isJoined ? 'btn ghost' : 'btn primary'; btn.textContent = isJoined ? 'Joined' : 'Join';
      btn.addEventListener('click', ()=> toggleJoinEvent(ev.id));

      const more = document.createElement('button'); more.className='btn ghost'; more.textContent='View'; more.addEventListener('click', ()=> openDetails(ev));
      actions.appendChild(btn); actions.appendChild(more);

      card.appendChild(av); card.appendChild(info); card.appendChild(actions);
      frag.appendChild(card);
    }
    feed.appendChild(frag);
  }

  // Details with map
  function openDetails(ev){
    const s = document.getElementById('sheet'); s.innerHTML='';
    const title = document.createElement('div'); title.innerHTML = `<strong style="font-size:20px">${ev.title}</strong>`;
    const meta = document.createElement('div'); meta.className='meta'; meta.textContent = `${timeStr(ev.time)} ‚Ä¢ ${distStr(ev.dist)}`;
    const p = document.createElement('p'); p.style.marginTop='12px'; p.style.color='var(--muted-2)'; p.style.lineHeight='1.5'; p.textContent = ev.desc;
    const mapWrap = document.createElement('div'); mapWrap.className='map-small'; mapWrap.id='detailMap';
    const hostRow = document.createElement('div'); hostRow.className='host-row';
    const hat = document.createElement('div'); hat.style.width='56px'; hat.style.height='56px'; hat.style.borderRadius='12px'; hat.style.background='linear-gradient(135deg,var(--accent),#4C1D95)'; hat.style.display='flex'; hat.style.alignItems='center'; hat.style.justifyContent='center'; hat.style.color='white'; hat.style.fontWeight='800'; hat.textContent = ev.host.name[0];
    const hb = document.createElement('div'); const hname = document.createElement('div'); hname.style.fontWeight='800'; hname.textContent = ev.host.name; const hbio = document.createElement('div'); hbio.style.color='var(--muted-2)'; hbio.textContent = ev.host.bio;
    hb.appendChild(hname); hb.appendChild(hbio); hostRow.appendChild(hat); hostRow.appendChild(hb);
    const joinWrap = document.createElement('div'); joinWrap.style.marginTop='16px'; const join = document.createElement('button');
    const joined = getJoinedSet().has(ev.id);
    join.className = joined ? 'btn ghost' : 'btn primary'; join.style.width='100%'; join.textContent = joined ? 'Joined' : 'Join Event';
    join.addEventListener('click', ()=>{ if(!currentUser){ openAuth(); showToast('Sign in to join'); return;} toggleJoinEvent(ev.id); if(!joined){ s.classList.remove('show'); destroyDetailMap(); } });
    joinWrap.appendChild(join);
    s.appendChild(title); s.appendChild(meta); s.appendChild(p); s.appendChild(mapWrap); s.appendChild(hostRow); s.appendChild(joinWrap);
    s.classList.add('show'); s.setAttribute('aria-hidden','false');
    setTimeout(()=> initDetailMap(ev),120);
  }

  function initDetailMap(ev){
    try{ destroyDetailMap(); const mapEl = document.getElementById('detailMap'); if(!mapEl) return; detailMap = L.map('detailMap',{zoomControl:false,attributionControl:false}).setView([ev.lat, ev.lng],15); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(detailMap); const marker = L.marker([ev.lat, ev.lng]).addTo(detailMap).bindPopup(`<strong>${ev.title}</strong><br>${ev.host.name}`); marker.openPopup(); setTimeout(()=> detailMap.zoomControl ? detailMap.zoomControl.addTo(detailMap) : null,250);}catch(e){console.warn('map',e)}
  }
  function destroyDetailMap(){ try{ if(detailMap){ detailMap.remove(); detailMap=null; } const existing = document.getElementById('detailMap'); if(existing) existing.innerHTML=''; }catch(e){}
  }

  // mini map in the panel
  function initMiniMap(){ try{ const mm = document.getElementById('miniMap'); const m = L.map(mm,{zoomControl:false,attributionControl:false}).setView([12.935,77.624],13); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(m); const marker = L.circleMarker([12.9343,77.6292],{radius:8,fill:true}).addTo(m); }catch(e){}
  }

  // create event UI (uses #sheet so we don't add DOM nodes elsewhere)
  function openCreateForm(){ if(!currentUser){ openAuth(); showToast('Sign in to create'); return; }
    const s = q('#sheet'); s.innerHTML = '';
    const title = document.createElement('div'); title.innerHTML = '<strong style="font-size:18px">Create event</strong>';
    const form = document.createElement('div'); form.style.marginTop='12px';
    form.innerHTML = `
      <div class="form-grid">
        <div>
          <div class="form-row">
            <label class="label" for="ce_title">Event title</label>
            <input id="ce_title" placeholder="e.g. Synthwave Jam" class="input" />
          </div>

          <div class="form-row">
            <label class="label" for="ce_desc">Short description</label>
            <textarea id="ce_desc" placeholder="One or two lines describing your event" class="input"></textarea>
            <div class="field-help">Keep it short and actionable ‚Äî what, who, and any requirements.</div>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:end">
            <div class="form-row">
              <label class="label" for="ce_time">Date & time</label>
              <input id="ce_time" type="datetime-local" class="input" />
            </div>

            <div class="form-row">
              <label class="label" for="ce_dist">Distance (meters)</label>
              <input id="ce_dist" type="number" min="0" placeholder="400" class="input" />
            </div>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div class="form-row">
              <label class="label" for="ce_cat">Category</label>
              <select id="ce_cat" class="input">
                <option>Music</option>
                <option>Tech</option>
                <option>Sports</option>
                <option>Food</option>
                <option>Fitness</option>
                <option>General</option>
              </select>
            </div>

            <div class="form-row">
              <label class="label" for="ce_location">Location (optional)</label>
              <input id="ce_location" placeholder="City or address" class="input" />
            </div>
          </div>

          <div class="form-row" style="margin-top:6px">
            <label class="label">Advanced (optional)</label>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <div class="pill">Private</div>
              <div class="pill">Paid</div>
              <div class="pill">Limited slots</div>
            </div>
            <div class="field-help">You can update these later from the event page.</div>
          </div>

          <div class="form-actions">
            <button id="ce_create" class="btn primary">Create event</button>
            <button id="ce_cancel" class="btn ghost">Cancel</button>
          </div>
        </div>

        <div>
          <div style="font-weight:800;margin-bottom:10px">Host</div>
          <div class="host-preview">
            <div class="avatar">${currentUser?currentUser.name[0].toUpperCase():'H'}</div>
            <div>
              <div style="font-weight:800">${currentUser?currentUser.name:'Sign in to host'}</div>
              <div style="font-size:13px;color:var(--muted-2);margin-top:6px">Your event will show on your profile and in nearby searches.</div>
            </div>
          </div>

          <div style="margin-top:12px">
            <div class="label">Preview</div>
            <div style="margin-top:8px;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:rgba(255,255,255,0.01)">
              <div style="font-weight:800" id="previewTitle">Event title</div>
              <div style="font-size:13px;color:var(--muted-2);margin-top:6px" id="previewMeta">Time ‚Ä¢ Category</div>
              <div style="font-size:13px;color:var(--muted-2);margin-top:8px" id="previewDesc">Short description preview appears here.</div>
            </div>
          </div>
        </div>
      </div>`;
    s.appendChild(title); s.appendChild(form); s.classList.add('show'); s.setAttribute('aria-hidden','false');

    q('#ce_cancel').addEventListener('click', ()=>{ s.classList.remove('show'); s.setAttribute('aria-hidden','true'); });
    q('#ce_create').addEventListener('click', ()=>{
      const title = q('#ce_title').value.trim(); const desc = q('#ce_desc').value.trim(); const time = q('#ce_time').value.trim(); const dist = parseInt(q('#ce_dist').value.trim()||0); const cat = q('#ce_cat').value.trim()||'General';
      if(!title || !time){ showToast('Please add title and time'); return; }
      const events = loadEvents(); const id = 'e'+Date.now(); const ev = {id,title,desc,time,dist,cat,host:{name:currentUser.name,bio:'Host',contact:currentUser.email,email:currentUser.email},lat:12.935, lng:77.62};
      events.unshift(ev); saveEvents(events); render(events); s.classList.remove('show'); s.setAttribute('aria-hidden','true'); showToast('Event created');
    });
  }

  // My Events / Clubs view
  function openMySheet(){ if(!currentUser){ openAuth(); showToast('Sign in to view your events'); return; }
    const s = q('#sheet'); s.innerHTML='';
    const title = document.createElement('div'); title.innerHTML = '<strong style="font-size:18px">My activity</strong>';
    const tabs = document.createElement('div'); tabs.style.display='flex'; tabs.style.gap='8px'; tabs.style.marginTop='12px';
    const tj = document.createElement('button'); tj.className='filter active'; tj.textContent='Joined';
    const tc = document.createElement('button'); tc.className='filter'; tc.textContent='Created';
    const tb = document.createElement('button'); tb.className='filter'; tb.textContent='Clubs';
    tabs.appendChild(tj); tabs.appendChild(tc); tabs.appendChild(tb);

    const listWrap = document.createElement('div'); listWrap.style.marginTop='12px';

    function renderJoined(){ const joined = getJoinedSet(); const events = loadEvents().filter(e=> joined.has(e.id)); if(events.length===0) listWrap.innerHTML='<div style="color:var(--muted-2)">No joined events yet</div>'; else { listWrap.innerHTML=''; events.forEach(ev=>{ const r = document.createElement('div'); r.style.padding='10px'; r.style.borderRadius='10px'; r.style.border='1px solid rgba(255,255,255,0.03)'; r.style.marginBottom='8px'; r.innerHTML = `<div style="font-weight:700">${ev.title}</div><div style="font-size:13px;color:var(--muted-2)">${timeStr(ev.time)} ‚Ä¢ ${ev.cat}</div>`; listWrap.appendChild(r); }); } }
    function renderCreated(){ const events = loadEvents().filter(e=> e.host && e.host.email === currentUser.email); if(events.length===0) listWrap.innerHTML='<div style="color:var(--muted-2)">No created events</div>'; else { listWrap.innerHTML=''; events.forEach(ev=>{ const r = document.createElement('div'); r.style.padding='10px'; r.style.borderRadius='10px'; r.style.border='1px solid rgba(255,255,255,0.03)'; r.style.marginBottom='8px'; r.innerHTML = `<div style="font-weight:700">${ev.title}</div><div style="font-size:13px;color:var(--muted-2)">${timeStr(ev.time)} ‚Ä¢ ${ev.cat}</div>`; listWrap.appendChild(r); }); } }
    function renderClubs(){ listWrap.innerHTML = '<div style="color:var(--muted-2)">No clubs yet ‚Äî this is a placeholder for club memberships.</div>'; }

    tj.addEventListener('click', ()=>{ tj.classList.add('active'); tc.classList.remove('active'); tb.classList.remove('active'); renderJoined(); });
    tc.addEventListener('click', ()=>{ tc.classList.add('active'); tj.classList.remove('active'); tb.classList.remove('active'); renderCreated(); });
    tb.addEventListener('click', ()=>{ tb.classList.add('active'); tj.classList.remove('active'); tc.classList.remove('active'); renderClubs(); });

    s.appendChild(title); s.appendChild(tabs); s.appendChild(listWrap);
    s.classList.add('show'); s.setAttribute('aria-hidden','false');
    // initial
    renderJoined();
  }

  // Auth
  function openAuth(){ const m = q('#authModal'); m.classList.add('show'); m.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
  function closeAuth(){ const m = q('#authModal'); m.classList.remove('show'); m.setAttribute('aria-hidden','true'); document.body.style.overflow='auto'; }
  q('#me').addEventListener('click', ()=>{ if(currentUser) openMySheet(); else openAuth(); });
  q('#profileBottom').addEventListener('click', ()=>{ if(currentUser) openMySheet(); else openAuth(); });
  q('#create').addEventListener('click', ()=> openCreateForm());
  q('#closeAuth').addEventListener('click', closeAuth);
  q('#toRegister').addEventListener('click', ()=>{ const n=prompt('Enter name') || ''; const e=prompt('Enter email') || ''; if(!n||!e){ showToast('Name & email required'); return; } currentUser = {name:n,email:e}; localStorage.setItem('hl_user', JSON.stringify(currentUser)); closeAuth(); updateUserUI(); showToast('Welcome '+n); });
  q('#doLogin').addEventListener('click', ()=>{ const e= q('#loginEmail').value.trim(); if(!e){ showToast('Enter your email'); return;} currentUser = {name:e.split('@')[0],email:e}; localStorage.setItem('hl_user', JSON.stringify(currentUser)); closeAuth(); updateUserUI(); showToast('Signed in'); });
  function updateUserUI(){ if(currentUser) q('#me').innerHTML = `<div class="avatar">${currentUser.name[0].toUpperCase()}</div><div style="font-size:13px;color:var(--muted-2);">${currentUser.name.split(' ')[0]}</div>`; else q('#me').innerHTML = `<div class="avatar">H</div><div style="font-size:13px;color:var(--muted-2);">Sign in</div>`; }
  updateUserUI();

  // Filters
  document.querySelectorAll('.filter').forEach(btn=> btn.addEventListener('click', ()=>{ document.querySelectorAll('.filter').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); const f = btn.dataset.filter; const events = loadEvents(); if(f==='nearby') render([...events].sort((a,b)=>a.dist-b.dist)); else if(f==='today') render(events.filter(x=> new Date(x.time).toDateString() === new Date().toDateString())); else render(events.filter(x=> x.cat.toLowerCase() === f)); }));

  // Chat (localStorage)
  const chatBtn = q('#chatBtn'); const chatModal = q('#chat'); const chatBody = q('#chatBody'); const chatInput = q('#chatInput'); const sendMsg = q('#sendMsg');
  const GROUPS = ['general','music','sports']; let activeGroup='general';
  function loadMessages(group){ return JSON.parse(localStorage.getItem('chat_'+group) || '[]'); }
  function saveMessage(group,msg){ const arr = loadMessages(group); arr.push(msg); localStorage.setItem('chat_'+group, JSON.stringify(arr)); }
  function renderChatList(){ chatBody.innerHTML=''; const groupsWrap = document.createElement('div'); groupsWrap.style.display='flex'; groupsWrap.style.gap='8px'; groupsWrap.style.paddingBottom='12px'; GROUPS.forEach(g=>{ const b = document.createElement('button'); b.className='filter'+(g===activeGroup?' active':''); b.textContent = '#'+g; b.addEventListener('click', ()=> openGroup(g)); groupsWrap.appendChild(b); }); chatBody.appendChild(groupsWrap); const msgs = loadMessages(activeGroup); const msgsWrap = document.createElement('div'); msgsWrap.style.marginTop='8px'; msgs.forEach(m=>{ const el = document.createElement('div'); el.className = 'msg '+(m.from==='me'?'me':'them'); el.textContent = m.text; msgsWrap.appendChild(el); }); chatBody.appendChild(msgsWrap); chatBody.scrollTop = chatBody.scrollHeight; }
  function openGroup(g){ activeGroup=g; renderChatList(); chatInput.placeholder = 'Message #'+g; }
  chatBtn.addEventListener('click', ()=>{ chatModal.classList.add('show'); chatModal.setAttribute('aria-hidden','false'); renderChatList(); });
  q('#closeChat').addEventListener('click', ()=>{ chatModal.classList.remove('show'); chatModal.setAttribute('aria-hidden','true'); });
  sendMsg.addEventListener('click', ()=>{ const text = chatInput.value.trim(); if(!text) return; const msg = {from:'me',text,ts:Date.now()}; saveMessage(activeGroup,msg); chatInput.value=''; renderChatList(); showToast('Sent'); });
  chatInput.addEventListener('keypress',(e)=>{ if(e.key==='Enter'){ sendMsg.click(); } });

  // init
  render(loadEvents()); initMiniMap();
  </script>
</body>
</html>
