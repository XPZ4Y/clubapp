<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>HyperLocal ‚Äî Polished Mobile (Light & Dark, Responsive)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<meta name="theme-color" content="#ffffff" id="meta-theme" />
<style>
:root{
  --bg:#F7FBFF; --card:#FFFFFF; --primary:#2563EB; --accent:#FF7A59; --muted:#566270; --glass:rgba(255,255,255,0.72);
  --shadow:0 8px 30px rgba(15,23,42,0.08); --radius:14px; --gap:12px; --max-w:980px; --text:#071229;
}
@media (prefers-color-scheme: dark){
  :root{ --bg:#071226; --card:#0b1220; --primary:#4f9cff; --accent:#ff8a66; --muted:#9aa6b2; --glass:rgba(8,12,18,0.6); --shadow:0 8px 30px rgba(0,0,0,0.6); --text:#E6F0FF; }
}
/* safe area & responsive tweaks */
:root{ --safe-bottom: env(safe-area-inset-bottom); }
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
body{transition:background .28s ease}
.app{max-width:var(--max-w);margin:0 auto;padding:14px;}

/* Header */
.header{display:flex;gap:10px;align-items:center;padding:8px 6px}
.brand{display:flex;gap:10px;align-items:center}
.logo-dot{width:14px;height:14px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#ffb37b);box-shadow:0 4px 14px rgba(0,0,0,0.06)}
.title{font-weight:800;color:var(--primary);font-size:16px}
.searchWrap{flex:1;display:flex;align-items:center;gap:8px}
.search{flex:1;background:var(--glass);padding:10px;border-radius:12px;display:flex;align-items:center;border:1px solid rgba(86,98,112,0.05)}
.search input{border:0;outline:0;background:transparent;width:100%;font-size:15px;color:inherit}
.icon-btn{width:44px;height:44px;border-radius:12px;background:var(--card);border:0;box-shadow:var(--shadow);display:inline-flex;align-items:center;justify-content:center}

/* Filters */
.filters{display:flex;gap:10px;overflow:auto;padding:8px 4px;margin:10px 0}
.filter{flex:0 0 auto;background:transparent;border:1px solid rgba(86,98,112,0.06);padding:8px 12px;border-radius:999px;color:var(--muted);font-size:14px}
.filter.active{background:linear-gradient(90deg,var(--primary),#60a5fa);color:#fff;border-color:transparent;box-shadow:0 8px 26px rgba(37,99,235,0.12)}

/* Feed */
.feed{display:flex;flex-direction:column;gap:12px;padding-bottom:calc(140px + var(--safe-bottom))}
.card{display:flex;gap:12px;align-items:center;background:var(--card);padding:12px;border-radius:var(--radius);box-shadow:var(--shadow);transition:transform .18s ease,box-shadow .18s ease}
.card:active{transform:translateY(1px)}
.avatar{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,#ffd59a,#ff9aa2);display:flex;align-items:center;justify-content:center;font-weight:700}
.info{flex:1}
.name{font-weight:800;font-size:15px;margin:0}
.desc{font-size:13px;color:var(--muted);margin-top:6px}
.meta{font-size:13px;color:var(--muted);margin-top:6px}
.action-row{display:flex;gap:8px;align-items:center}
.btn{padding:10px 14px;border-radius:999px;border:0;font-weight:700;cursor:pointer;transition:transform .12s ease}
.btn.primary{background:linear-gradient(90deg,var(--primary),#60a5fa);color:#fff}
.btn.ghost{background:transparent;border:1px solid rgba(86,98,112,0.08);color:var(--muted)}
.micro{width:78px;height:52px;border-radius:10px;overflow:hidden;border:1px solid rgba(7,18,41,0.04);display:flex;align-items:center;justify-content:center}

/* Bottom nav ‚Äî includes chat */
.bottom{position:fixed;left:12px;right:12px;bottom:calc(12px + var(--safe-bottom));padding:8px;background:var(--glass);backdrop-filter:blur(8px);display:flex;justify-content:space-between;align-items:center;border-radius:999px;box-shadow:0 12px 32px rgba(15,23,42,0.08);z-index:60}
.icon{width:48px;height:48px;border-radius:12px;background:var(--card);display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow)}
.fab{width:60px;height:60px;border-radius:999px;background:linear-gradient(90deg,var(--primary),#60a5fa);display:flex;align-items:center;justify-content:center;color:#fff;font-size:26px;border:0}

/* Chat badge */
.badge{position:absolute;top:-6px;right:-6px;background:#ef4444;color:#fff;border-radius:999px;padding:4px 6px;font-size:11px;box-shadow:0 4px 10px rgba(0,0,0,0.2)}

/* Modal / Sheet */
.modal{position:fixed;left:10px;right:10px;bottom:10px;background:var(--card);border-radius:16px;padding:14px;transform:translateY(110%);transition:transform .32s cubic-bezier(.22,.9,.3,1),opacity .24s;max-height:88vh;overflow:auto;z-index:80}
.modal.show{transform:translateY(0);opacity:1}
.modal .close{position:absolute;right:14px;top:12px;border:0;background:transparent;font-size:18px}

.sheet{position:fixed;right:12px;left:12px;bottom:12px;background:var(--card);padding:12px;border-radius:12px;transform:translateY(110%);transition:transform .28s;box-shadow:var(--shadow);z-index:80}
.sheet.show{transform:translateY(0)}
.sheet .sheet-close{position:absolute;right:16px;top:12px;background:transparent;border:0;font-size:18px}
.sheet .map-small{width:100%;height:180px;border-radius:10px;margin-top:8px;overflow:hidden}
.sheet .host-row{display:flex;gap:10px;align-items:center;margin-top:10px}
.sheet .host-avatar{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,#ffd59a,#ff9aa2);display:flex;align-items:center;justify-content:center;font-weight:800}
.sheet .host-bio{font-size:13px;color:var(--muted)}

/* Chat modal */
.chat-modal{position:fixed;left:10px;right:10px;bottom:12px;background:var(--card);border-radius:16px;padding:0;transform:translateY(110%);transition:transform .28s;max-height:86vh;display:flex;flex-direction:column;z-index:90}
.chat-modal.show{transform:translateY(0)}
.chat-header{display:flex;align-items:center;padding:12px;border-bottom:1px solid rgba(86,98,112,0.06)}
.chat-title{font-weight:800;margin-left:8px}
.chat-body{padding:12px;overflow:auto;flex:1}
.msg{display:inline-block;padding:8px 10px;border-radius:10px;margin:6px 0;max-width:78%}
.msg.me{background:linear-gradient(90deg,var(--primary),#60a5fa);color:#fff;margin-left:auto}
.msg.them{background:rgba(86,98,112,0.06);color:var(--text)}
.chat-input{display:flex;padding:10px;border-top:1px solid rgba(86,98,112,0.06)}
.chat-input input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(86,98,112,0.06);margin-right:8px}
.chat-input button{padding:10px 12px;border-radius:10px;border:0;background:var(--primary);color:#fff}

.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:120px;background:rgba(7,18,41,0.92);color:#fff;padding:10px 14px;border-radius:12px;z-index:95;opacity:0;transition:opacity .3s}
.toast.show{opacity:1}

/* small-screen tuning */
@media (max-width:420px){ .avatar{width:46px;height:46px} .micro{width:64px;height:44px} .fab{width:56px;height:56px;font-size:22px} .icon{width:44px;height:44px} }
@media(min-width:980px){ .app{padding:22px} .bottom{display:none} }
</style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="brand"><div class="logo-dot" aria-hidden></div><div class="title">HyperLocal</div></div>
    <div class="searchWrap">
      <div class="search" role="search"><input id="search" placeholder="Search events, people or tags" aria-label="Search"/></div>
      <button id="me" class="icon-btn" aria-label="Profile">üôÇ</button>
    </div>
  </header>

  <div class="filters" role="tablist" aria-label="Quick filters">
    <button class="filter active" data-filter="nearby">Nearby</button>
    <button class="filter" data-filter="today">Today</button>
    <button class="filter" data-filter="music">Music</button>
    <button class="filter" data-filter="sports">Sports</button>
  </div>

  <main class="feed" id="feed" aria-live="polite"></main>

  <nav class="bottom" aria-label="Main">
    <button id="home" class="icon" aria-label="Home">üè†</button>
    <button id="searchBtn" class="icon" aria-label="Search">üîç</button>
    <button id="create" class="fab" aria-label="Create">Ôºã</button>
    <div style="position:relative">
      <button id="chatBtn" class="icon" aria-label="Chat">üí¨</button>
      <span id="chatBadge" class="badge" style="display:none">0</span>
    </div>
    <button id="profileBottom" class="icon" aria-label="Profile">üë§</button>
  </nav>
</div>

<!-- Auth modal (improved) -->
<div id="authModal" class="modal" aria-hidden="true">
  <button class="close" id="closeAuth">‚úï</button>
  <div class="auth-card" role="dialog" aria-modal="true">
    <div class="auth-header"><div style="width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#ffb37b);display:flex;align-items:center;justify-content:center;font-weight:800;color:#071229">H</div><div><div class="auth-title">Welcome back</div><div class="auth-sub">Sign in to join nearby meetups</div></div></div>

    <div id="authForms">
      <div id="loginForm">
        <input id="loginEmail" class="input" placeholder="Email" type="email" />
        <input id="loginPass" class="input" placeholder="Password" type="password" />
        <div style="display:flex;gap:8px">
          <button id="doLogin" class="btn primary" style="flex:1">Sign in</button>
          <button id="toRegister" class="btn ghost" style="flex:1">Create</button>
        </div>
      </div>

      <div id="registerForm" style="display:none">
        <input id="regName" class="input" placeholder="Your name" />
        <input id="regEmail" class="input" placeholder="Email" type="email" />
        <input id="regPass" class="input" placeholder="Create a password" type="password" />
        <div style="display:flex;gap:8px">
          <button id="doRegister" class="btn primary" style="flex:1">Create account</button>
          <button id="toLogin" class="btn ghost" style="flex:1">Back</button>
        </div>
      </div>
    </div>

    <div style="margin-top:8px">
      <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Or continue with</div>
      <div class="socials">
        <button class="social" aria-label="Continue with Google">Google</button>
        <button class="social" aria-label="Continue with Apple">Apple</button>
      </div>
    </div>
  </div>
</div>

<!-- Event details sheet -->
<div id="sheet" class="sheet" aria-hidden="true">
  <button class="sheet-close" id="closeSheet">‚úï</button>
  <!-- content injected here -->
</div>

<!-- Chat modal -->
<div id="chat" class="chat-modal" aria-hidden="true">
  <div class="chat-header"><button id="closeChat" class="icon-btn" aria-label="close">‚úï</button><div class="chat-title">Groups</div></div>
  <div class="chat-body" id="chatBody">
    <!-- group list or messages rendered here -->
  </div>
  <div class="chat-input">
    <input id="chatInput" placeholder="Message #general" />
    <button id="sendMsg">Send</button>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* Responsive + chat integration */
const SAMPLE = [
  {id:'e1',title:'Sunrise Run',desc:'8 km, easy pace',time:'2025-11-20T06:00:00Z',dist:850,cat:'Fitness',host:{name:'Sam',bio:'Runner ‚Ä¢Coffee lover',contact:'@sam_run'},lat:12.935,lng:77.624},
  {id:'e2',title:'Acoustic Jam',desc:'Bring a guitar',time:'2025-11-20T19:00:00Z',dist:1200,cat:'Music',host:{name:'Maya',bio:'Guitarist ‚Ä¢ Host',contact:'@maya_music'},lat:12.9343,lng:77.6292},
  {id:'e3',title:'Python Meetup',desc:'Beginners welcome',time:'2025-11-21T16:00:00Z',dist:2200,cat:'Tech',host:{name:'Rohit',bio:'Backend dev ‚Ä¢ Mentor',contact:'@rohit_codes'},lat:12.94,lng:77.62},
  {id:'e4',title:'Park Soccer',desc:'Pickup match',time:'2025-11-19T17:30:00Z',dist:600,cat:'Sports',host:{name:'Asha',bio:'Coach ‚Ä¢ Friendly',contact:'@asha_play'},lat:12.9312,lng:77.63}
];

const feed = document.getElementById('feed');
const toast = document.getElementById('toast');
let currentUser = JSON.parse(localStorage.getItem('hl_user') || 'null');
let detailMap = null; // Leaflet map instance

function q(sel){return document.querySelector(sel)}
function timeStr(iso){const d=new Date(iso);return d.toLocaleString(undefined,{hour:'numeric',minute:'2-digit',day:'numeric',month:'short'})}
function distStr(m){return m<1000?m+' m':(m/1000).toFixed(1)+' km'}

function showToast(msg, t=1700){toast.textContent = msg; toast.classList.add('show'); clearTimeout(window._t); window._t = setTimeout(()=> toast.classList.remove('show'), t)}

// render optimized
function render(list){ feed.innerHTML=''; const frag = document.createDocumentFragment();
  for(const ev of list){
    const card = document.createElement('div'); card.className='card';
    const av = document.createElement('div'); av.className='avatar'; av.textContent = ev.host.name[0];
    const info = document.createElement('div'); info.className='info';
    const name = document.createElement('div'); name.className='name'; name.textContent = ev.title;
    const desc = document.createElement('div'); desc.className='desc'; desc.textContent = ev.desc;
    const meta = document.createElement('div'); meta.className='meta'; meta.textContent = `${timeStr(ev.time)} ¬∑ ${distStr(ev.dist)}`;
    info.appendChild(name); info.appendChild(desc); info.appendChild(meta);
    const micro = document.createElement('div'); micro.className='micro'; micro.innerHTML = `<svg viewBox="0 0 100 70" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="70" rx="8" fill="transparent"/></svg>`;
    const actions = document.createElement('div'); actions.className='action-row';
    const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='Join';
    btn.addEventListener('click', ()=>{ if(!currentUser){ openAuth(); showToast('Sign in to join'); return;} showToast("You're in ‚Äî enjoy!"); });
    const more = document.createElement('button'); more.className='btn ghost'; more.textContent='Details'; more.addEventListener('click', ()=> openDetails(ev));
    actions.appendChild(btn); actions.appendChild(more);
    card.appendChild(av); card.appendChild(info); card.appendChild(micro); card.appendChild(actions);
    frag.appendChild(card);
  }
  feed.appendChild(frag);
}

// details with map + host
function openDetails(ev){
  const s = document.getElementById('sheet'); s.innerHTML='';
  const title = document.createElement('div'); title.innerHTML = `<strong style="font-size:16px">${ev.title}</strong>`;
  const meta = document.createElement('div'); meta.style.color='var(--muted)'; meta.style.marginTop='6px'; meta.textContent = `${timeStr(ev.time)} ¬∑ ${distStr(ev.dist)}`;
  const p = document.createElement('p'); p.style.marginTop='8px'; p.style.color='var(--muted)'; p.textContent = ev.desc;
  const mapWrap = document.createElement('div'); mapWrap.className='map-small'; mapWrap.id='detailMap';
  const hostRow = document.createElement('div'); hostRow.className='host-row';
  const hat = document.createElement('div'); hat.className='host-avatar'; hat.textContent = ev.host.name[0];
  const hb = document.createElement('div'); const hname = document.createElement('div'); hname.style.fontWeight='800'; hname.textContent = ev.host.name; const hbio = document.createElement('div'); hbio.className='host-bio'; hbio.textContent = ev.host.bio; const hcontact = document.createElement('div'); hcontact.style.fontSize='13px'; hcontact.style.marginTop='6px'; hcontact.style.color='var(--muted)'; hcontact.textContent = `Contact: ${ev.host.contact}`;
  hb.appendChild(hname); hb.appendChild(hbio); hb.appendChild(hcontact); hostRow.appendChild(hat); hostRow.appendChild(hb);
  const joinWrap = document.createElement('div'); joinWrap.style.marginTop='12px'; const join = document.createElement('button'); join.className='btn primary'; join.style.width='100%'; join.textContent='Join'; join.addEventListener('click', ()=>{ if(!currentUser){ openAuth(); showToast('Sign in to join'); return;} showToast('You are in ‚Äî have fun!'); s.classList.remove('show'); destroyDetailMap(); });
  joinWrap.appendChild(join);
  s.appendChild(title); s.appendChild(meta); s.appendChild(p); s.appendChild(mapWrap); s.appendChild(hostRow); s.appendChild(joinWrap);
  s.classList.add('show'); s.setAttribute('aria-hidden','false');
  setTimeout(()=> initDetailMap(ev),120);
}

function initDetailMap(ev){
  try{ destroyDetailMap(); const mapEl = document.getElementById('detailMap'); if(!mapEl) return; detailMap = L.map('detailMap',{zoomControl:false,attributionControl:false}).setView([ev.lat, ev.lng],15); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(detailMap); const marker = L.marker([ev.lat, ev.lng]).addTo(detailMap).bindPopup(`<strong>${ev.title}</strong><br>${ev.host.name}`); marker.openPopup(); setTimeout(()=> detailMap.zoomControl ? detailMap.zoomControl.addTo(detailMap) : null,250);}catch(e){console.warn('map',e)}
}
function destroyDetailMap(){ try{ if(detailMap){ detailMap.remove(); detailMap=null; } const existing = document.getElementById('detailMap'); if(existing) existing.innerHTML=''; }catch(e){}
}

q('#closeSheet').addEventListener('click', ()=>{ const s = q('#sheet'); s.classList.remove('show'); s.setAttribute('aria-hidden','true'); destroyDetailMap(); });

// Auth
function openAuth(){ const m = q('#authModal'); m.classList.add('show'); m.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
function closeAuth(){ const m = q('#authModal'); m.classList.remove('show'); m.setAttribute('aria-hidden','true'); document.body.style.overflow='auto'; }
q('#me').addEventListener('click', ()=>{ if(currentUser) showToast('Signed in as '+currentUser.name); else openAuth(); });
q('#profileBottom').addEventListener('click', ()=>{ if(currentUser) showToast('Signed in as '+currentUser.name); else openAuth(); });
q('#create').addEventListener('click', ()=>{ if(!currentUser){ openAuth(); showToast('Sign in to create'); return; } showToast('Create (coming soon)') });
q('#closeAuth').addEventListener('click', closeAuth);
q('#toRegister').addEventListener('click', ()=>{ q('#loginForm').style.display='none'; q('#registerForm').style.display='block'; });
q('#toLogin').addEventListener('click', ()=>{ q('#registerForm').style.display='none'; q('#loginForm').style.display='block'; });
q('#doRegister').addEventListener('click', ()=>{ const n=q('#regName').value.trim(); const e=q('#regEmail').value.trim(); if(!n||!e){ showToast('Enter your name and email'); return;} currentUser = {name:n,email:e}; localStorage.setItem('hl_user', JSON.stringify(currentUser)); closeAuth(); updateUserUI(); showToast('Welcome '+n); });
q('#doLogin').addEventListener('click', ()=>{ const e=q('#loginEmail').value.trim(); if(!e){ showToast('Enter your email'); return;} currentUser = {name:e.split('@')[0],email:e}; localStorage.setItem('hl_user', JSON.stringify(currentUser)); closeAuth(); updateUserUI(); showToast('Signed in'); });
function updateUserUI(){ if(currentUser) q('#me').textContent = currentUser.name[0].toUpperCase(); else q('#me').textContent='üôÇ'; }
updateUserUI();

// Filters
document.querySelectorAll('.filter').forEach(btn=> btn.addEventListener('click', ()=>{ document.querySelectorAll('.filter').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); const f = btn.dataset.filter; if(f==='nearby') render([...SAMPLE].sort((a,b)=>a.dist-b.dist)); else if(f==='today') render(SAMPLE.filter(x=> new Date(x.time).toDateString() === new Date().toDateString())); else render(SAMPLE.filter(x=> x.cat.toLowerCase() === f)); }));

document.addEventListener('keydown',(e)=>{ if(e.key==='Escape'){ closeAuth(); const s = q('#sheet'); if(s){ s.classList.remove('show'); destroyDetailMap(); } const c = q('#chat'); if(c){ c.classList.remove('show'); } }});

// Theme sync
(function setupThemeSync(){ const metaTheme = document.getElementById('meta-theme'); const applyTheme = (isDark) => { if(isDark){ document.documentElement.style.setProperty('--bg','#071226'); document.documentElement.style.setProperty('--card','#0b1220'); document.documentElement.style.setProperty('--primary','#4f9cff'); document.documentElement.style.setProperty('--accent','#ff8a66'); document.documentElement.style.setProperty('--muted','#9aa6b2'); document.documentElement.style.setProperty('--glass','rgba(8,12,18,0.6)'); document.documentElement.style.setProperty('--shadow','0 8px 30px rgba(0,0,0,0.6)'); document.documentElement.style.setProperty('--text','#E6F0FF'); if(metaTheme) metaTheme.setAttribute('content','#071226'); document.documentElement.setAttribute('data-theme','dark'); } else { document.documentElement.style.setProperty('--bg','#F7FBFF'); document.documentElement.style.setProperty('--card','#FFFFFF'); document.documentElement.style.setProperty('--primary','#2563EB'); document.documentElement.style.setProperty('--accent','#FF7A59'); document.documentElement.style.setProperty('--muted','#566270'); document.documentElement.style.setProperty('--glass','rgba(255,255,255,0.72)'); document.documentElement.style.setProperty('--shadow','0 8px 30px rgba(15,23,42,0.08)'); document.documentElement.style.setProperty('--text','#071229'); if(metaTheme) metaTheme.setAttribute('content','#ffffff'); document.documentElement.setAttribute('data-theme','light'); } }; const mq = window.matchMedia('(prefers-color-scheme: dark)'); applyTheme(mq.matches); try{ mq.addEventListener('change',(e)=> applyTheme(e.matches)); }catch(err){ mq.addListener((e)=> applyTheme(e.matches)); }})();

// CHAT ‚Äî simple group chat mock (localStorage)
const chatBtn = q('#chatBtn'); const chatModal = q('#chat'); const chatBody = q('#chatBody'); const chatInput = q('#chatInput'); const sendMsg = q('#sendMsg'); const chatBadge = q('#chatBadge');
const GROUPS = ['general','music','sports']; // simple groups
let activeGroup = 'general';
function loadMessages(group){ return JSON.parse(localStorage.getItem('chat_'+group) || '[]'); }
function saveMessage(group,msg){ const arr = loadMessages(group); arr.push(msg); localStorage.setItem('chat_'+group, JSON.stringify(arr)); updateChatBadge(); }
function renderChatList(){ chatBody.innerHTML=''; const groupsWrap = document.createElement('div'); groupsWrap.style.display='flex'; groupsWrap.style.gap='8px'; groupsWrap.style.padding='8px'; GROUPS.forEach(g=>{ const b = document.createElement('button'); b.className='btn ghost'; b.textContent = '#'+g; b.addEventListener('click', ()=> openGroup(g)); groupsWrap.appendChild(b); }); chatBody.appendChild(groupsWrap); // load active group messages
  const msgs = loadMessages(activeGroup); const msgsWrap = document.createElement('div'); msgsWrap.id='msgsWrap'; msgsWrap.style.marginTop='8px'; msgs.forEach(m=>{ const el = document.createElement('div'); el.className = 'msg '+(m.from==='me'?'me':'them'); el.textContent = m.text; msgsWrap.appendChild(el); }); chatBody.appendChild(msgsWrap); chatBody.scrollTop = chatBody.scrollHeight; }
function openGroup(g){ activeGroup = g; renderChatList(); chatInput.placeholder = 'Message #'+g; }
function updateChatBadge(){ // sum unread (very simple) - count messages
  let total=0; GROUPS.forEach(g=>{ total += loadMessages(g).length; }); if(total>0){ chatBadge.style.display='inline-block'; chatBadge.textContent = total; } else chatBadge.style.display='none'; }
chatBtn.addEventListener('click', ()=>{ chatModal.classList.add('show'); chatModal.setAttribute('aria-hidden','false'); renderChatList(); updateChatBadge(); });
q('#closeChat').addEventListener('click', ()=>{ chatModal.classList.remove('show'); chatModal.setAttribute('aria-hidden','true'); });
sendMsg.addEventListener('click', ()=>{ const text = chatInput.value.trim(); if(!text) return; const msg = {from:'me',text,ts:Date.now()}; saveMessage(activeGroup,msg); chatInput.value=''; renderChatList(); showToast('Sent'); });
chatInput.addEventListener('keypress',(e)=>{ if(e.key==='Enter'){ sendMsg.click(); } });

// init
render(SAMPLE); updateChatBadge();

</script>
</body>
</html>